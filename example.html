 <!DOCTYPE html>
<html style="height: 100%">
  <head>
    <title>Mouse Posyx</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>

  <style>
  body {
    margin: 0px 0px 0px 0px;
    padding: 0px 0px 0px 0px;
    height: 100%;
    touch-action: none;
  }

  #touchpad {
    height: 50%;
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    background-color: gray;
  }

  .lokura {
    display: flex;
    flex-flow: row wrap;
  }

  .div_click {
    height: 100px;
    width: 50%;
  }

  #left_click {
    background-color: red;
  }

  #right_click {
    background-color: yellow;
  }
  </style>

  <body>
    <div id="touchpad"></div>
    <div class="lokura">
      <div id="left_click" class="div_click"></div>
      <div id="right_click" class="div_click"></div>
    </div>
  </body>

<script>
  var sensivity = 3;
  var touchpad_html = document.querySelector("#touchpad");
  var left_html = document.querySelector("#left_click");
  var right_html = document.querySelector("#right_click");

  touchpad_html.addEventListener("touchstart", touchStart, false);
  touchpad_html.addEventListener("touchend", touchEnd, false);

  left_html.addEventListener("touchstart", leftClickEvent, false);
  left_html.addEventListener("touchend", leftReleaseClickEvent, false);

  right_html.addEventListener("touchstart", rightClickEvent, false);
  right_html.addEventListener("touchend", rightReleaseClickEvent, false);

  function leftReleaseClickEvent(e) {
    socket.send("RELEASE_CLICK@1");
  }

  function leftClickEvent(e) {
    socket.send("CLICK@1");
  }

  function rightClickEvent(e) {
    socket.send("CLICK@3");
  }

  function rightReleaseClickEvent(e) {
    socket.send("RELEASE_CLICK@3");
  }

  position = {
    initial_x:0, initial_y:0
  }

  function touchStart(e) {
    e.target.addEventListener("touchmove", touchMoved, false);
    position.initial_x = e.targetTouches[0].clientX;
    position.initial_y = e.targetTouches[0].clientY;
  }

  function touchEnd(e) {
    e.target.removeEventListener("touchmove", touchMoved, false);
    position.initial_x = 0;
    position.initial_y = 0;
  }

  function touchMoved(e) {
    final_x = position.initial_x - e.targetTouches[0].clientX;
    final_y = position.initial_y - e.targetTouches[0].clientY;

    touchpad_html.innerHTML = "X:" + position.initial_x + "  Y:" + position.initial_y;

    position.initial_x = e.targetTouches[0].clientX;
    position.initial_y = e.targetTouches[0].clientY;

    x = Math.floor(final_x * sensivity);
    y = Math.floor(final_y * sensivity);

    if ((x != 0) || (y != 0)){
      socket.send("MOVE@"+ x + "@" + y);  
    }
  
  }

  // connection parts
  var socket = new WebSocket( "ws://" + document.domain + ':' + location.port, "mouse-protocol" );
  socket.onopen = function() { console.log("socket open");}
  socket.onclose = function() { console.log("socket close");}
  socket.onmessage = function(msg) { console.log("socket message: " + msg.data); }

  function stress_test() {
    var limit = 100000;

    for (i=0; i < limit; i++) {
      var value1 = Math.floor(Math.random() * 1920);
      var value2 = Math.floor(Math.random() * 1080);
      socket.send(value1+"@"+value2);
    }
  }
</script>
</html>
